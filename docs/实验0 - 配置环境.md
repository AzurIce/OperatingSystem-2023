# å®éªŒ0 - é…ç½®ç¯å¢ƒ

> æ‰€ç”¨è®¾å¤‡åŠç³»ç»Ÿï¼šMacbook Pro M2 Max, MacOS Ventura 13.5.2

> å› ä¸ºæˆ‘æœ‰é­”æ³•ï¼Œæ‰€ä»¥çœç•¥äº†å„ç§é•œåƒæºé…ç½®ç›¸å…³æ­¥éª¤ğŸ¥³

## ä¸€ã€å®‰è£… docker

https://www.docker.com/

## äºŒã€åˆ›å»ºå®¹å™¨åŠé¡¹ç›®

https://github.com/AzurIce/OperatingSystem-2023

é¦–å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼š

![image-20230915111720950](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230915111720950.png)

è·å– openeuler çš„ docker é•œåƒï¼š

```bash
docker pull openeuler/openeuler
```

![image-20230915111517477](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230915111517477.png)

è¿›å…¥åˆ°é¡¹ç›®ç›®å½•ï¼Œåˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨ï¼š

```bash
git clone git@github.com:AzurIce/OperatingSystem-2023.git
cd OperatingSystem-2023
docker run -it --mount type=bind,source=$(PWD),destination=/mnt openeuler/openeuler
```

![image-20230915111653570](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230915111653570.png)

ç„¶åä¾¿è¿›å…¥äº† openeuler ç¯å¢ƒï¼Œå¹¶å¯ä»¥é€šè¿‡ `/mnt` ç›®å½•è®¿é—®åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ã€‚

## ä¸‰ã€å¼€å‘ç¯å¢ƒé…ç½®

### 1. å¿…è¦è½¯ä»¶

```bash
dnf install curl vim gcc git
```

### 2. Rust å¼€å‘ç¯å¢ƒ

```bash
curl https://sh.rustup.rs -sSf | sh
source
```

> å¯ä»¥ç›´æ¥åœ¨è¿™ä¸€æ­¥é€‰æ‹© nightly ç‰ˆæœ¬ï¼Œæˆ–ä¹‹åå†é€šè¿‡ä¸‹é¢å‘½ä»¤è®¾ç½®ï¼š
>
> ```bash
> rustup install nightly
> rustup default nightly
> ```

```bash
rustup target add riscv64gc-unknown-none-elf
cargo install cargo-binutils
rustup component add llvm-tools-preview
rustup component add rust-src
```

ç„¶ååœ¨ é¡¹ç›®ç›®å½•ä¸‹å¿ƒé—´ `rust-toolchain` æ–‡ä»¶ï¼Œå†™å…¥ `nightly-2022-10-19` æ¥å›ºå®šæˆ‘ä»¬åˆ°æ—¶å€™å°†è¦ä½¿ç”¨çš„ rust ç‰ˆæœ¬

### 3. å®‰è£…ä¸€äº›åŸºæœ¬çš„è½¯ä»¶åŒ…

```bash
dnf groupinstall "Development Tools"
dnf install autoconf automake gcc gcc-c++ kernel-devel curl libmpc-devel mpfr-devel gmp-devel \
              glib2 glib2-devel make cmake gawk bison flex texinfo gperf libtool patchutils bc \
              python3 ninja-build wget xz
```

> å‘1:
>
> ![image-20230915113559614](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230915113559614.png)
>
> å…ˆæ‰§è¡Œä¸€æ¬¡ `dnf distro-sync` å³å¯

### 4. ä»æºç å®‰è£… qemu

```bash
wget https://download.qemu.org/qemu-5.2.0.tar.xz
tar xvJf qemu-5.2.0.tar.xz
```

```bash
cd qemu-5.2.0
./configure --target-list=riscv64-softmmu,riscv64-linux-user
make -j$(nproc) install
```

> å®‰è£…å®Œæˆåå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤éªŒè¯qemuæ˜¯å¦å®‰è£…æˆåŠŸã€‚
>
> ```bash
> qemu-system-riscv64 --version
> qemu-riscv64 --version
> ```
>

## å››ã€ä¿å­˜é…ç½®åˆ° docker é•œåƒä¸­

åœ¨dockerå¤–ï¼ˆè‡ªå·±çš„æ“ä½œç³»ç»Ÿä¸­ï¼‰çš„ç»ˆç«¯å†…è¿è¡Œï¼š

```bash
docker commit -m "Configured environment" -a "AzurIce" f7ca2f7d1322077670897839a7a68e5954d5530338117fac026abc6395003405 my_openeuler
```

é‚£ä¸€å¤§é•¿ä¸²hashå­—ç¬¦ä¸²æ¥æºäºè¿™é‡Œï¼š

![image-20230915114608023](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230915114608023.png)

ç„¶åå¯ä»¥åœ¨ Images ä¸­çœ‹åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„é•œåƒï¼š

![image-20230915114644557](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230915114644557.png)

å¯ä»¥ä½¿ç”¨

```
docker run -it --mount type=bind,source=$(PWD),destination=/mnt my_openeuler

```

æ¥ç”¨åˆšæ‰çš„é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨å¹¶è¿è¡Œï¼Œå…¶ç¯å¢ƒæ­£æ˜¯åˆšæ‰ä¿å­˜æ—¶çš„ç¯å¢ƒï¼š

![image-20230920131524512](./å®éªŒ0 - é…ç½®ç¯å¢ƒ.assets/image-20230920131524512.png)
